"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}();!function(){var t=function(){function t(e,a){return _classCallCheck(this,t),this.params=$.extend({type:"date",startDate:moment(),endDate:moment(),locale:"ru",format:"YYYY.MM.DD",delimiter:"-",ranges:[],modalMode:!1,minDate:null,maxDate:null,firstDayOfWeek:moment.localeData().firstDayOfWeek(),onShow:function(){},onHide:function(){}},a),this.el=e,this.$el=$(document.createElement("div")),this.params.modalMode?$(document.body).append(this.$el):this.el.after(this.$el),moment.locale(this.params.locale),this.viewStartDate=this.params.startDate,this.viewEndDate=this.params.endDate,this.dateStart=this.params.startDate.clone(),this.dateEnd=this.params.endDate.clone(),this.render.call(this),this.initEvents(),this.setValue(),this}return _createClass(t,[{key:"setActiveDate",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?"start":arguments[1],a=t.currentTarget,n=parseInt(a.innerHTML,10),r=this.params.minDate,d=this.params.maxDate,i="start"===e?this.viewStartDate:this.viewEndDate;1===String(n).length&&(n="0"+n);var s=moment(i.format("YYYY-MM")+"-"+n);null!==r&&"object"===("undefined"==typeof r?"undefined":_typeof(r))&&s.isBefore(r)||null!==d&&"object"===("undefined"==typeof d?"undefined":_typeof(d))&&s.isAfter(d)||("start"===e?s.isAfter(this.dateEnd,"day")&&"rangedate"===this.params.type?this.dateEnd=s:this.dateStart=s:s.isBefore(this.dateStart,"day")&&"rangedate"===this.params.type?this.dateStart=s:this.dateEnd=s,t.stopPropagation(),this.render(),this.setValue())}},{key:"setStartDate",value:function(t){this.viewStartDate=moment(t),this.dateStart=moment(t),this.render()}},{key:"setEndDate",value:function(t){this.viewEndDate=moment(t),this.dateEnd=moment(t),this.render()}},{key:"changeEventDate",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?"start":arguments[1],a=arguments.length<=2||void 0===arguments[2]?"day":arguments[2],n=arguments.length<=3||void 0===arguments[3]?"add":arguments[3],r=this.params.minDate,d=this.params.maxDate,i=this.viewStartDate[n](1,a);null!==r&&"object"===("undefined"==typeof r?"undefined":_typeof(r))&&moment(i).isBefore(r)||null!==d&&"object"===("undefined"==typeof d?"undefined":_typeof(d))&&moment(i).isAfter(d)?(this.viewStartDate=moment(i),this.render()):"start"===e?this.setStartDate(i):this.setEndDate(i),t.stopPropagation()}},{key:"setActiveRange",value:function(t){var e=parseInt(t.currentTarget.getAttribute("data-range"),10),a=this.params.ranges[e];a&&(this.dateStart=a.startDate,this.viewStartDate=a.startDate,this.dateEnd=a.endDate,this.viewEndDate=a.endDate,this.render())}},{key:"initEvents",value:function(){var t=this;this.$el.on("click",".dt__calendar_start .dt__calendar_m_d",function(e){return t.setActiveDate(e,"start")}).on("click",".dt__calendar_end .dt__calendar_m_d",function(e){return t.setActiveDate(e,"end")}).on("click",".dt__start .dt__calendar_head_month .next",function(e){return t.changeEventDate(e,"start","month","add")}).on("click",".dt__start .dt__calendar_head_month .prev",function(e){return t.changeEventDate(e,"start","month","subtract")}).on("click",".dt__end .dt__calendar_head_month .next",function(e){return t.changeEventDate(e,"end","month","add")}).on("click",".dt__end .dt__calendar_head_month .prev",function(e){return t.changeEventDate(e,"end","month","subtract")}).on("click",".dt__start .dt__calendar_head_year .next",function(e){return t.changeEventDate(e,"start","year","add")}).on("click",".dt__start .dt__calendar_head_year .prev",function(e){return t.changeEventDate(e,"start","year","subtract")}).on("click",".dt__end .dt__calendar_head_year .next",function(e){return t.changeEventDate(e,"end","year","add")}).on("click",".dt__end .dt__calendar_head_year .prev",function(e){return t.changeEventDate(e,"end","year","subtract")}).on("click",".dt__ranges_item",function(e){return t.setActiveRange(e)}).on("click",".dt-modal_close",function(e){return t.hideCalendar()}).on("click",".dt__wrapper",function(t){return!1}),this.el.on("click",function(t){return t.stopPropagation()}).on("focus",function(e){t.showCalendar(),e.stopPropagation()}),$(document).on("click",function(e){return t.hideCalendar()}),$(window).on("keydown",function(e){return t.keyDown(e)})}},{key:"keyDown",value:function(t){27===t.keyCode&&this.hideCalendar()}},{key:"showCalendar",value:function(){this.params.onShow(),this.$el.addClass("show")}},{key:"hideCalendar",value:function(){this.params.onHide(),this.$el.removeClass("show")}},{key:"renderMonth",value:function(t){for(var e=arguments.length<=1||void 0===arguments[1]?"start":arguments[1],a="",n=t.daysInMonth(),r=("start"===e?this.dateStart:this.dateEnd,this.params.minDate),d=this.params.maxDate,i="",s=0;n>s;s++){var o=s+1,l=moment(t.format("YYYY-MM")+"-"+(10>o?"0"+o:o));i=l.isSame(this.dateStart,"day")?"active ":l.isSame(this.dateEnd,"day")&&"rangedate"===this.params.type?"active ":"","rangedate"===this.params.type&&l.isAfter(this.dateStart,"day")&&l.isBefore(this.dateEnd,"day")&&(i+="between "),"object"===("undefined"==typeof r?"undefined":_typeof(r))&&l.isBefore(r)&&(i+="disabled"),"object"===("undefined"==typeof d?"undefined":_typeof(d))&&l.isAfter(d)&&(i+="disabled"),a+='<div class="dt__calendar_m_d '+i+'">'+o+"</div>"}return a}},{key:"renderCalendar",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?"start":arguments[1],a="",n=e,r="start"===e?this.dateStart:this.dateEnd,d=moment.weekdaysShort(),i=t.clone().startOf("month").weekday();if(0!=this.params.firstDayOfWeek)for(var s=this.params.firstDayOfWeek;s>0;)d.push(d.shift()),s--;a+='<div class="dt__calendar dt__'+e+'">',a+='<div class="dt__calendar_head">',a+='<div class="dt__calendar_head_wday">'+r.format("dddd")+"</div>",a+='<div class="dt__calendar_head_month"><i class="prev"><</i><span>'+r.format("MMMM")+'</span><i class="next">></i></div>',a+='<div class="dt__calendar_head_day">'+r.format("D")+"</div>",a+='<div class="dt__calendar_head_year"><i class="prev"><</i><span>'+r.format("Y")+'</span><i class="next">></i></div>',a+="</div>",a+='<div class="dt__calendar_nav">',a+='<div class="dt__calendar_nav_title">'+t.format("MMM YYYY")+"</div>",a+="</div>",a+='<div class="dt__calendar_'+n+'"><div class="dt__calendar_m">',a+='<div class="dt__calendar_m_w">';for(var o=0;o<d.length;o++)a+='<div class="dt__calendar_m_w_n">'+d[o]+"</div>";a+="</div>";for(var l=0;i>l;l++)a+='<div class="dt__calendar_m_d_e"></div>';return a+=this.renderMonth(t,e),a+="</div></div>",this.params.modalMode&&(a+='<div class="dt-modal_close">&#215;</div>'),a+="</div>"}},{key:"renderRanges",value:function(){var t="",e=this.params.ranges;t+='<div class="dt__ranges">';for(var a=0,n=e.length;n>a;a++)t+='<div class="dt__ranges_item" data-range="'+a+'"">'+e[a].label+"</div>";return t+="</div>"}},{key:"render",value:function(){var t="";this.params.modalMode&&(t+='<div class="dt-modal_wrapper">'),t+='<div class="dt__wrapper">',t+=this.renderCalendar(this.viewStartDate,"start"),"rangedate"===this.params.type&&(t+=this.renderCalendar(this.viewEndDate,"end"),this.params.ranges.length&&(t+=this.renderRanges())),this.params.modalMode&&(t+="</div>"),t+="</div>",this.$el.html(t),this.onAfterRender()}},{key:"setValue",value:function(){"date"===this.params.type?this.el.val(this.dateStart.format(this.params.format)):this.el.val(this.dateStart.format(this.params.format)+this.params.delimiter+this.dateEnd.format(this.params.format))}},{key:"onAfterRender",value:function(){this.$el.addClass("dt"),"rangedate"==this.params.type&&this.$el.find(".dt__wrapper").addClass("rangedate"),this.params.modalMode&&this.$el.addClass("dt-modal")}},{key:"destroy",value:function(){this.$el.detach().off().remove()}}]),t}();window.jQuery&&(jQuery.fn.DatePicker=function(e){return new t(this,e)}),"function"==typeof define&&define("datetimepicker",function(){return t})}();